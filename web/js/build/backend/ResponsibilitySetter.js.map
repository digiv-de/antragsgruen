{"version":3,"sources":["backend/ResponsibilitySetter.ts"],"names":["ResponsibilitySetter","$list","this","on","userSelected","bind","onCommentSaveBtn","onKeyPressed","prototype","ev","preventDefault","$li","$","currentTarget","$row","parents","first","userId","data","name","find","text","url","post","_csrf","val","user","ret","removeClass","addClass","alert","saveComment","keyCode","stopPropagation","comment","hasClass","dropdown","exports"],"mappings":"uIAAA,IAAAA,EAAA,WACI,SAAAA,EAAoBC,IAAAC,KAAAD,MAAAA,GACVE,GAAG,QAAS,wBAAyBD,KAAKE,aAAaC,KAAKH,OAClED,EAAME,GAAG,QAAS,qCAAsCD,KAAKI,iBAAiBD,KAAKH,OACnFD,EAAME,GAAG,WAAY,+CAAgDD,KAAKK,aAAaF,KAAKH,OAyDpG,OAtDYF,EAAAQ,UAAAJ,aAAR,SAAqBK,GACjBA,EAAGC,iBACH,IAAMC,EAAMC,EAAEH,EAAGI,eACXC,EAAOH,EAAII,QAAQ,eAAeC,QAClCC,EAASN,EAAIO,KAAK,WAClBC,EAAOR,EAAIS,KAAK,SAASC,OACzBC,EAAMR,EAAKI,KAAK,YACtBN,EAAEW,KAAKD,EAAK,CACRE,MAASZ,EAAE,qBAAqBa,MAChCC,KAAMT,GACP,SAACU,GACIA,EAAa,SACbb,EAAKM,KAAK,aAAaQ,YAAY,YACnCjB,EAAIkB,SAAS,YACbf,EAAKM,KAAK,uBAAuBC,KAAKF,GAAMD,KAAK,UAAWD,IAE5Da,MAAM,qCAKV9B,EAAAQ,UAAAF,iBAAR,SAAyBG,GACrBA,EAAGC,iBACH,IAAMI,EAAeF,EAAEH,EAAGI,eAAeE,QAAQ,eAAeC,QAChEd,KAAK6B,YAAYjB,IAGbd,EAAAQ,UAAAD,aAAR,SAAqBE,GACjB,GAAkB,IAAdA,EAAGuB,QAAe,CAClBvB,EAAGC,iBACHD,EAAGwB,kBACH,IAAMnB,EAAeF,EAAEH,EAAGI,eAAeE,QAAQ,eAAeC,QAChEd,KAAK6B,YAAYjB,KAIjBd,EAAAQ,UAAAuB,YAAR,SAAoBjB,GAChB,IAAMoB,EAAUpB,EAAKM,KAAK,oCAAoCK,MACxDH,EAAMR,EAAKI,KAAK,YAEtBN,EAAEW,KAAKD,EAAK,CACRE,MAASZ,EAAE,qBAAqBa,MAChCS,QAAWA,GACZ,SAACP,GACIA,EAAa,SACbb,EAAKM,KAAK,0BAA0BC,KAAKa,GACrCpB,EAAKqB,SAAS,SACdrB,EAAKM,KAAK,oBAAoBgB,SAAS,WAG3CN,MAAM,qCAItB9B,EA7DA,GAAaqC,EAAArC,qBAAAA","file":"ResponsibilitySetter.js","sourcesContent":["export class ResponsibilitySetter {\n    constructor(private $list: JQuery) {\n        $list.on(\"click\", \".respHolder .respUser\", this.userSelected.bind(this));\n        $list.on(\"click\", \".respHolder .respCommentRow button\", this.onCommentSaveBtn.bind(this));\n        $list.on(\"keypress\", \".respHolder .respCommentRow input[type=text]\", this.onKeyPressed.bind(this));\n    }\n\n    private userSelected(ev: Event) {\n        ev.preventDefault();\n        const $li = $(ev.currentTarget);\n        const $row = $li.parents(\".respHolder\").first();\n        const userId = $li.data(\"user-id\");\n        const name = $li.find(\".name\").text();\n        const url = $row.data(\"save-url\");\n        $.post(url, {\n            '_csrf': $('input[name=_csrf]').val(),\n            user: userId\n        }, (ret) => {\n            if (ret['success']) {\n                $row.find(\".respUser\").removeClass(\"selected\");\n                $li.addClass(\"selected\");\n                $row.find(\".responsibilityUser\").text(name).data(\"user-id\", userId);\n            } else {\n                alert(\"An error occurred while saving\")\n            }\n        });\n    }\n\n    private onCommentSaveBtn(ev: Event) {\n        ev.preventDefault();\n        const $row: JQuery = $(ev.currentTarget).parents(\".respHolder\").first() as JQuery;\n        this.saveComment($row);\n    }\n\n    private onKeyPressed(ev: KeyboardEvent) {\n        if (ev.keyCode == 13) { // Enter\n            ev.preventDefault();\n            ev.stopPropagation();\n            const $row: JQuery = $(ev.currentTarget).parents(\".respHolder\").first() as JQuery;\n            this.saveComment($row);\n        }\n    }\n\n    private saveComment($row: JQuery) {\n        const comment = $row.find(\".respCommentRow input[type=text]\").val() as string;\n        const url = $row.data(\"save-url\");\n\n        $.post(url, {\n            '_csrf': $('input[name=_csrf]').val(),\n            'comment': comment\n        }, (ret) => {\n            if (ret['success']) {\n                $row.find(\".responsibilityComment\").text(comment);\n                if ($row.hasClass('open')) {\n                    $row.find('.dropdown-toggle').dropdown(\"toggle\");\n                }\n            } else {\n                alert(\"An error occurred while saving\")\n            }\n        });\n    }\n}\n"]}