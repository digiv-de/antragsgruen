define(["require","exports","../shared/AntragsgruenEditor","../shared/DraftSavingEngine"],function(t,e,o,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AmendmentEdit=void 0;var a=function(){function r(t){this.$form=t,this.hasChanged=!1;var e=t.data("multi-paragraph-mode");if(void 0===e)throw"data-multi-paragraph-mode needs to be set";this.lang=$("html").attr("lang"),this.$form.find(".editorialChange input").on("change",this.editorialOpenerClicked.bind(this)).trigger("change"),this.initGlobalAlternative(),$(".input-group.date").datetimepicker({locale:this.lang,format:"L"}),e?this.initMultiParagraphMode():this.spmInit();var a=$("#draftHint"),i=a.data("motion-id"),n=a.data("amendment-id");new d.DraftSavingEngine(t,a,"motion_"+i+"_"+n),t.on("submit",function(){$(window).off("beforeunload",r.onLeavePage)})}return r.prototype.initGlobalAlternative=function(){},r.prototype.editorialOpenerClicked=function(){var t=this,e=this.$form.find("#sectionHolderEditorial"),a=e.find(".texteditor");if(this.$form.find(".editorialChange input").prop("checked")){if(e.removeClass("hidden"),void 0===CKEDITOR.instances.amendmentEditorial_wysiwyg){var i=new o.AntragsgruenEditor("amendmentEditorial_wysiwyg");a.parents("form").on("submit",function(){t.$form.find(".editorialChange input").prop("checked")?a.parent().find("textarea.raw").val(i.getEditor().getData()):a.parent().find("textarea.raw").val("")}),$("#"+a.attr("id")).on("keypress",this.onContentChanged.bind(this))}}else e.addClass("hidden")},r.prototype.initMultiParagraphMode=function(){var n=this;$(".wysiwyg-textarea:not(#sectionHolderEditorial)").each(function(t,e){var a=$(e).find(".texteditor"),i=new o.AntragsgruenEditor(a.attr("id")).getEditor();a.parents("form").on("submit",function(){a.parent().find("textarea.raw").val(i.getData()),void 0!==i.plugins.lite&&(i.plugins.lite.findPlugin(i).acceptAll(),a.parent().find("textarea.consolidated").val(i.getData()))}),$("#"+a.attr("id")).on("keypress",n.onContentChanged.bind(n))}),this.$form.find(".resetText").on("click",function(t){var e=$(t.currentTarget).parents(".wysiwyg-textarea").find(".texteditor");window.CKEDITOR.instances[e.attr("id")].setData(e.data("original-html")),$(t.currentTarget).parents(".modifiedActions").addClass("hidden")})},r.prototype.spmSetModifyable=function(){var t=this.$spmParagraphs.filter(".modified");0==t.length?this.$spmParagraphs.addClass("modifyable"):(this.$spmParagraphs.removeClass("modifyable"),$("input[name=modifiedParagraphNo]").val(t.data("paragraph-no")),$("input[name=modifiedSectionId]").val(t.parents(".texteditorBox").data("section-id")))},r.prototype.spmOnParaClick=function(t){var e=$(t.currentTarget);if(e.hasClass("modifyable")){e.addClass("modified"),this.spmSetModifyable();var a,i=e.find(".texteditor");a=void 0!==CKEDITOR.instances[i.attr("id")]?CKEDITOR.instances[i.attr("id")]:new o.AntragsgruenEditor(i.attr("id")).getEditor(),i.attr("contenteditable","true"),i.parents("form").on("submit",function(){i.parent().find("textarea.raw").val(a.getData()),void 0!==a.plugins.lite&&(a.plugins.lite.findPlugin(a).acceptAll(),i.parent().find("textarea.consolidated").val(a.getData()))}),$("#"+i.attr("id")).on("keypress",this.onContentChanged.bind(this)),i.trigger("focus")}},r.prototype.spmRevert=function(t){t.preventDefault(),t.stopPropagation();var e=$(t.target).parents(".wysiwyg-textarea"),a=e.find(".texteditor");a.attr("id");void 0!==CKEDITOR.instances[a.attr("id")]&&o.AntragsgruenEditor.destroyInstanceById(a.attr("id")),a.html(e.data("original")),e.removeClass("modified"),this.spmSetModifyable()},r.prototype.spmInitNonSingleParas=function(t,e){var a=$(e),i=a.find(".texteditor");if(!a.hasClass("hidden")){var n=new o.AntragsgruenEditor(i.attr("id")).getEditor();i.parents("form").on("submit",function(){i.parent().find("textarea.raw").val(n.getData()),void 0!==n.plugins.lite&&(n.plugins.lite.findPlugin(n).acceptAll(),i.parent().find("textarea.consolidated").val(n.getData()))}),$("#"+i.attr("id")).on("keypress",this.onContentChanged.bind(this))}},r.prototype.spmInit=function(){this.$spmParagraphs=$(".wysiwyg-textarea.single-paragraph"),this.$spmParagraphs.on("click",this.spmOnParaClick.bind(this)),this.$spmParagraphs.find(".modifiedActions .revert").on("click",this.spmRevert.bind(this)),this.spmSetModifyable(),$(".wysiwyg-textarea").filter(":not(.single-paragraph)").each(this.spmInitNonSingleParas.bind(this)),$(".texteditorBox").each(function(t,e){var a=$(e),i=a.data("section-id"),n=a.data("changed-para-no");-1<n&&$("#section_holder_"+i+"_"+n).trigger("click")})},r.onLeavePage=function(){return __t("std","leave_changed_page")},r.prototype.onContentChanged=function(){this.hasChanged||(this.hasChanged=!0,$("body").hasClass("testing")||$(window).on("beforeunload",r.onLeavePage))},r}();e.AmendmentEdit=a});
//# sourceMappingURL=AmendmentEdit.js.map
